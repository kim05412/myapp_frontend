<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>post</title>
    <link rel="stylesheet" href="/basic.css" />
    <link rel="stylesheet" href="/drop-down.css" />
    <link rel="stylesheet" href="write.css" />
  </head>
  <body>
    <header>
      <div><a href="/index.html">ProEatsNearby</a></div>
      <div class="catagory">
        <h2>포스트 작성</h2>
        <ul>
          <li>
            <a href="menu/menu.html"
              >메뉴
              <ul class="sub-menu">
                <li><a href="menu/asian.html">동남아식</a></li>
                <li><a href="menu/western.html">양식</a></li>
                <li><a href="menu/japenese.html">일식</a></li>
                <li><a href="menu/chinese.html">중식</a></li>
                <li><a href="menu/korean.html">한식</a></li>
                <li><a href="menu/others.html">그외</a></li>
              </ul></a
            >
          </li>
          <li><a href="new.html">새로운 식당</a></li>
          <li><a href="old.html">오래된 식당</a></li>
          <li><a href="best.html">베스트 포스팅</a></li>
          <li><a href="nearby.html">회사 근처</a></li>
          <li>
            <a href="/user/mypage.html"
              >마이페이지
              <ul class="sub-menu">
                <li><a href="/user/profile.html">내 프로필</a></li>
                <li><a href="/user/mines.html">내 포스트</a></li>
                <li><a href="/user/restuarants.html">내 식당</a></li>
                <li><a href="/user/likness.html">좋아요한 포스팅</a></li>
              </ul></a
            >
          </li>
        </ul>
      </div>
    </header>
    <main>
      <!-- 포스트 작성 -->
      <form style="margin-bottom: 3rem" name="write">
        <div>
          <!-- 메뉴 종류 선택 -->
          <div>
            <select class="menu-type" name="menu-type">
              <option value="">메뉴의 타입을 선택해주세요</option>
              <option value="1">동남아식</option>
              <option value="2">양식</option>
              <option value="3">일식</option>
              <option value="4">중식</option>
              <option value="5">기타</option>
            </select>
            <select class="menu-type" name="menu-type">
              <option value="">타입 추가</option>
              <option value="1">동남아식</option>
              <option value="2">양식</option>
              <option value="3">일식</option>
              <option value="4">중식</option>
              <option value="5">기타</option>
            </select>
            <select class="menu-type" name="menu-type">
              <option value="">타입 추가</option>
              <option value="1">동남아식</option>
              <option value="2">양식</option>
              <option value="3">일식</option>
              <option value="4">중식</option>
              <option value="5">기타</option>
            </select>
            <select class="menu-type" name="menu-type">
              <option value="">타입 추가</option>
              <option value="1">동남아식</option>
              <option value="2">양식</option>
              <option value="3">일식</option>
              <option value="4">중식</option>
              <option value="5">기타</option>
            </select>
          </div>
          <input type="title" id="title" placeholder="제목을 작성해주세요" />
        </div>
        <p class="img">
          <input type="text" id="menu" placeholder="메뉴명을 입력해주세요" />
          <input type="file" id="fileInput" accept="image/*" />
        </p>
        <input
          type="text"
          id="address"
          placeholder="식당의 주소를 입력해 주세요"
        />
        <textarea
          id="review"
          cols="160"
          rows="25"
          placeholder="식당에 대한 솔직한 후기를 작성해 주세요"
          style="margin-top: 0.25rem"
        ></textarea>
        <ul>
          <li><button type="submit" class="btn-submit">게시</button></li>
          <!-- <li><button class="btn-modify">수정</button></li> -->
          <li><button class="btn-save">저장</button></li>
        </ul>
      </form>
    </main>
    <script>
      //작성시 로그인
      (() => {
        // hiddenButton();
        // loginLogout();
        const token = getCookie("token");
        console.log(token);
        if (!token) {
          window.location.href = "http://localhost:5500";
          alert("포스팅을 작성하기 위해서는 로그인이 필요합니다.");
        }
      })();

      // 제출버튼 -> 추가 기능
      (() => {
        //컬렉션
        const form = document.querySelector("form");
        const btnSubmit = form.querySelector(".btn-submit");
        const filesInput = document.getElementById("fileInput");
        // NodeList 객체로 반환->array로 변환-> 각 요소(select)의 value값 추출->새로운 배열
        const types = Array.from(form.querySelectorAll(".menu-type")).map(
          (select) => select.value
        );
        const title = form.querySelector("#title");
        const menu = form.querySelector("#menu");
        const address = form.querySelector("#address");
        const review = form.querySelector("textarea");

        btnSubmit.addEventListener(async (e) => {
          e.preventDefault();
          const formData = new FormData();
          // 여러 개의 파일 추가
          for (const file of filesInput.files) {
            formData.append("files[]", file);
          }

          formData.append("types", JSON.stringify(types));
          formData.append("title", title.value);
          formData.append("menu", menu.value);
          formData.append("address", address.value);
          formData.append("review", review.value);

          try {
            const response = await fetch("http://localhost:8080/posts", {
              method: "POST",
              body: formData, // FormData 전송
            });

            if (response.ok) {
              alert("포스트 작성 완료.");
              window.location.replace("http://localhost:5500");
            } else {
              alert("포스트 작성 중 오류가 발생.");
            }
          } catch (error) {
            console.error("Error:", error);
            alert("서버 오류가 발생했습니다.");
          }
        });
      })();
      // 여러 파일 추가
      const filesInput = document.getElementById("fileInput");
      files.setAttribute("multiple", "multiple");

      filesInput.addEventListener("change", (event) => {
        const selectedFiles = event.target.files; // 여러 개의 선택된 파일들의 목록

        // 선택된 각 파일에 대한 처리
        for (const file of selectedFiles) {
          // file은 각각의 선택된 파일을 나타냄
          console.log(file.name); // 파일 이름 출력 또는 다른 원하는 작업 수행
        }
      });
      // UI 추가 (display)
      // document.forms[0].insertAdjacentHTML(
      //   "beforeend",
      //   cardTemplate(request.data)
      // );
    </script>
    <script src="/auth/auth.js"></script>
    <script src="/sidebar.js"></script>
    <script src="/search.js"></script>
    <script src="auth/login.js"></script>
    <!-- <script src="write.js"></script> -->
  </body>
</html>
